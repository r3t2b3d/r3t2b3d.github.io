<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>🌈C@T :)</title>
    <link>https://r3t2b3d.github.io/</link>
    <description>Recent content on 🌈C@T :)</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sat, 14 Sep 2024 18:09:10 +0800</lastBuildDate><atom:link href="https://r3t2b3d.github.io/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title></title>
      <link>https://r3t2b3d.github.io/misc/</link>
      <pubDate>Sun, 22 Sep 2024 13:46:42 +0800</pubDate>
      
      <guid>https://r3t2b3d.github.io/misc/</guid>
      <description> My partial crypto challenge, maybe you will like it. repo
N1CTF 2023 Challenge Difficulty Tag e2D1P ★★★ LLL, Linear Algebra JQCTF-Final 2023 Challenge Difficulty Tag Br0kenAuth ★★★ HEC, HNP N1Junior 2024 Challenge Difficulty Tag Masquerade ★ DSA Forge IEV@L ★★ Isogeny Hash, Jail JQCTF-Quals 2024 Challenge Difficulty Tag BabyOracle1 ★☆ McEliece, Broadcast attack BabyOracle2 ★★ SIDH, GPST attack S2DH ★★★ SIDH, Torsion point attack </description>
      <content:encoded><![CDATA[<blockquote>
<p>My partial crypto challenge, maybe you will like it. <a href="https://github.com/hash-hash/My-CTF-Challenges">repo</a></p>
</blockquote>
<h4 id="n1ctf-2023"><em>N1CTF 2023</em></h4>
<table>
<thead>
<tr>
<th style="text-align:center">Challenge</th>
<th style="text-align:center">Difficulty</th>
<th style="text-align:center">Tag</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">e2D1P</td>
<td style="text-align:center">★★★</td>
<td style="text-align:center">LLL, Linear Algebra</td>
</tr>
</tbody>
</table>
<h4 id="jqctf-final-2023"><em>JQCTF-Final 2023</em></h4>
<table>
<thead>
<tr>
<th style="text-align:center">Challenge</th>
<th style="text-align:center">Difficulty</th>
<th style="text-align:center">Tag</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Br0kenAuth</td>
<td style="text-align:center">★★★</td>
<td style="text-align:center">HEC, HNP</td>
</tr>
</tbody>
</table>
<h4 id="n1junior-2024"><em>N1Junior 2024</em></h4>
<table>
<thead>
<tr>
<th style="text-align:center">Challenge</th>
<th style="text-align:center">Difficulty</th>
<th style="text-align:center">Tag</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Masquerade</td>
<td style="text-align:center">★</td>
<td style="text-align:center">DSA Forge</td>
</tr>
<tr>
<td style="text-align:center">IEV@L</td>
<td style="text-align:center">★★</td>
<td style="text-align:center">Isogeny Hash, Jail</td>
</tr>
</tbody>
</table>
<h4 id="jqctf-quals-2024"><em>JQCTF-Quals 2024</em></h4>
<table>
<thead>
<tr>
<th style="text-align:center">Challenge</th>
<th style="text-align:center">Difficulty</th>
<th style="text-align:center">Tag</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">BabyOracle1</td>
<td style="text-align:center">★☆</td>
<td style="text-align:center">McEliece, Broadcast attack</td>
</tr>
<tr>
<td style="text-align:center">BabyOracle2</td>
<td style="text-align:center">★★</td>
<td style="text-align:center">SIDH, GPST attack</td>
</tr>
<tr>
<td style="text-align:center">S2DH</td>
<td style="text-align:center">★★★</td>
<td style="text-align:center">SIDH, Torsion point attack</td>
</tr>
</tbody>
</table>
]]></content:encoded>
    </item>
    
    <item>
      <title>Intro 2 Isogeny</title>
      <link>https://r3t2b3d.github.io/posts/intro-2-isogeny/</link>
      <pubDate>Sat, 14 Sep 2024 18:09:10 +0800</pubDate>
      
      <guid>https://r3t2b3d.github.io/posts/intro-2-isogeny/</guid>
      <description>TL:DR 考虑到同源的迷之上手难度对大🔥并不算友好，这里简单记录一些之前遇见过的或者自己出过的偏简单的同源题目，包括SIDH、CSIDH相关的不需要太深数学理解的东西。由于今年暑假 Crypto Hack 也是更新了一些与Isogeny相关的东西，比较推荐大家上手做一做，适合入门。
Isogeny 首先需要了解 Isogeny（同源）是什么？
简单来说就是同态映射，或者说是一个有理函数。对于曲线 $E_1,\ E_2$ ，映射 $\phi:E_1\rightarrow E_2$ 满足对于任意两点 $P,\ Q\in E_1$ 有 $\phi(P&#43;Q)=\phi(P)&#43;\phi(Q)$ ，我们称这样的函数 $\phi$ 为 $E_1$ 到 $E_2$ 的同源。
对于一个同态我们经常会考虑它的原像、像以及核，而核是多数时候比较关心的，在这里 $Ker(\phi)=\set{X|\phi(X)=O}$
在 SageMath 里可以通过一条曲线及其对应的核来定义映射 $\phi$，例如下面的代码
sage: E = EllipticCurve(GF(11), [1, 0]) ....: P = E.random_element() ....: phi = E.isogeny(P) ....: phi.codomain() Elliptic Curve defined by y^2 = x^3 &#43; 2 over Finite Field of size 11 sage: phi Isogeny of degree 4 from Elliptic Curve defined by y^2 = x^3 &#43; x over Finite Field of size 11 to Elliptic Curve defined by y^2 = x^3 &#43; 2 over Finite Field of size 11 且核和映射之间满足下述关系，</description>
      <content:encoded><![CDATA[<h2 id="tldr">TL:DR</h2>
<blockquote>
<p><strong>考虑到同源的迷之上手难度对大🔥并不算友好，这里简单记录一些之前遇见过的或者自己出过的偏简单的同源题目，包括SIDH、CSIDH相关的不需要太深数学理解的东西。由于今年暑假 Crypto Hack 也是更新了一些与Isogeny相关的东西，比较推荐大家上手做一做，适合入门。</strong></p>
</blockquote>
<h2 id="isogeny">Isogeny</h2>
<blockquote>
<p>首先需要了解 Isogeny（同源）是什么？</p>
</blockquote>
<p>简单来说就是同态映射，或者说是一个有理函数。对于曲线 $E_1,\ E_2$ ，映射 $\phi:E_1\rightarrow E_2$ 满足对于任意两点 $P,\ Q\in E_1$ 有 $\phi(P+Q)=\phi(P)+\phi(Q)$ ，我们称这样的函数 $\phi$ 为 $E_1$ 到 $E_2$ 的同源。</p>
<p>对于一个同态我们经常会考虑它的原像、像以及核，而核是多数时候比较关心的，在这里 $Ker(\phi)=\set{X|\phi(X)=O}$</p>
<p>在 SageMath 里可以通过一条曲线及其对应的核来定义映射 $\phi$，例如下面的代码</p>
<pre tabindex="0"><code>sage: E = EllipticCurve(GF(11), [1, 0])
....: P = E.random_element()
....: phi = E.isogeny(P)
....: phi.codomain()
Elliptic Curve defined by y^2 = x^3 + 2 over Finite Field of size 11
sage: phi
Isogeny of degree 4 from Elliptic Curve defined by y^2 = x^3 + x over Finite Field of size 11 to Elliptic Curve defined by y^2 = x^3 + 2 over Finite Field of size 11
</code></pre><p>且核和映射之间满足下述关系，</p>
<pre tabindex="0"><code>sage: P.order() == phi.degree()
True
</code></pre><p>实际上我上面的表述并不严谨，这里的核很明显应该为一个集合，但这里只是将 $P$ 作为了参数，实际上这代表了这样一个集合 $\set{k\cdot P|k\in \mathcal{Z}}$，更简洁的可以把这记为 n-torsion （其中 $n$ 为 $P$ 的阶）。通过实验，我们可以发现同源的度数和核的势相等，这里应该有更严谨的说法，限于水平只能通过类似实验的方式去验证同源的大多数性质了。</p>
<blockquote>
<p>基于同源的困难问题是什么？</p>
</blockquote>
<p>这大概是入手同源时最费解的一个问题了，不同于此前接触过的基于大整数分解、离散对数、格上短向量问题，同源的困难性理解起来有点抽象。简单来讲就是给定原像和像无法还原它们间的映射 $\phi$，当然这个困难程度和我们选择的参数有关系，对于小规模参数下的问题我们只需要暴力即可求解。</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>PIR Notes</title>
      <link>https://r3t2b3d.github.io/posts/pir-notes/</link>
      <pubDate>Sat, 03 Aug 2024 19:51:03 +0800</pubDate>
      
      <guid>https://r3t2b3d.github.io/posts/pir-notes/</guid>
      <description>PIR（Private Information Retrieval）一种特定MPC算法，类似于PSI（Private Set Intersection）
相对于PSI需要保护两方数据的隐私性，PIR提供较弱的功能只需保护一方数据的隐私性。</description>
      <content:encoded><![CDATA[<p>PIR（Private Information Retrieval）一种特定MPC算法，类似于PSI（Private Set Intersection）</p>
<p>相对于PSI需要保护两方数据的隐私性，PIR提供较弱的功能只需保护一方数据的隐私性。</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>N1CTF2021</title>
      <link>https://r3t2b3d.github.io/posts/n1ctf2021/</link>
      <pubDate>Tue, 12 Dec 2023 23:26:07 +0800</pubDate>
      
      <guid>https://r3t2b3d.github.io/posts/n1ctf2021/</guid>
      <description>Challenge Tags checkin Coppersmith, Math n1token1 HNP, Quadratic Sieve n1token2 Linear Algebra checkin task.py
from Crypto.Util.number import * from secret import flag p = getPrime(512) q = getPrime(512) n = p*q x = 2021*p&#43;1120*q h = (inverse(x,n)&#43;x)%n e = 65537 c = pow(bytes_to_long(flag), e, n) print(&amp;#39;n =&amp;#39;, n) print(&amp;#39;c =&amp;#39;, c) print(&amp;#39;h =&amp;#39;, h) print(&amp;#39;p0 =&amp;#39;, p &amp;gt;&amp;gt; 490) # n = 124592923216765837982528839202733339713655242872717311800329884147642320435241014134533341888832955643881019336863843062120984698416851559736918389766033534214383285754683751490292848191235308958825702189602212123282858416891155764271492033289942894367802529296453904254165606918649570613530838932164490341793 # c = 119279592136391518960778700178474826421062018379899342254406783670889432182616590099071219538938202395671695005539485982613862823970622126945808954842683496637377151180225469409261800869161467402364879561554585345399947589618235872378329510108345004513054262809629917083343715270605155751457391599728436117833 # h = 115812446451372389307840774747986196103012628652193338630796109042038320397499948364970459686079508388755154855414919871257982157430015224489195284512204803276307238226421244647463550637321174259849701618681565567468929295822889537962306471780258801529979716298619553323655541002084406217484482271693997457806 # p0 = 4055618 Solution $h=\frac{1}{x}&#43;x$</description>
      <content:encoded><![CDATA[<table>
<thead>
<tr>
<th>Challenge</th>
<th>Tags</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#checkin">checkin</a></td>
<td>Coppersmith, Math</td>
</tr>
<tr>
<td><a href="#n1token1">n1token1</a></td>
<td>HNP, Quadratic Sieve</td>
</tr>
<tr>
<td><a href="#n1token2">n1token2</a></td>
<td>Linear Algebra</td>
</tr>
</tbody>
</table>
<h2 id="checkin">checkin</h2>
<p><strong>task.py</strong></p>
<pre tabindex="0"><code>from Crypto.Util.number import *
from secret import flag
 
p = getPrime(512)
q = getPrime(512)
n = p*q
x = 2021*p+1120*q
h = (inverse(x,n)+x)%n
e = 65537
c = pow(bytes_to_long(flag), e, n)
 
print(&#39;n =&#39;, n)
print(&#39;c =&#39;, c)
print(&#39;h =&#39;, h)
print(&#39;p0 =&#39;, p &gt;&gt; 490)
 
# n = 124592923216765837982528839202733339713655242872717311800329884147642320435241014134533341888832955643881019336863843062120984698416851559736918389766033534214383285754683751490292848191235308958825702189602212123282858416891155764271492033289942894367802529296453904254165606918649570613530838932164490341793
# c = 119279592136391518960778700178474826421062018379899342254406783670889432182616590099071219538938202395671695005539485982613862823970622126945808954842683496637377151180225469409261800869161467402364879561554585345399947589618235872378329510108345004513054262809629917083343715270605155751457391599728436117833
# h = 115812446451372389307840774747986196103012628652193338630796109042038320397499948364970459686079508388755154855414919871257982157430015224489195284512204803276307238226421244647463550637321174259849701618681565567468929295822889537962306471780258801529979716298619553323655541002084406217484482271693997457806
# p0 = 4055618
</code></pre><h2 id="solution">Solution</h2>
<p>$h=\frac{1}{x}+x$</p>
<p>$\Rightarrow x^2-h\cdot x+1(mod\ n)$</p>
<p>We can get high bits of q through the known p high bits.</p>
<p>$x=2021\cdot p+1120\cdot q=(2021\cdot(2^{490}\cdot p_0+p_1)+1120\cdot(2^{490}\cdot q_0+q_1))$</p>
<p>The unknown part of x is less than 501 bits</p>
<p><code>small_roots</code> can solve this with <code>epsilon=0.02</code></p>
<p>It&rsquo;s higher than the theoretical bound, may be LLL sometimes do better.</p>
<pre tabindex="0"><code>n = 124592923216765837982528839202733339713655242872717311800329884147642320435241014134533341888832955643881019336863843062120984698416851559736918389766033534214383285754683751490292848191235308958825702189602212123282858416891155764271492033289942894367802529296453904254165606918649570613530838932164490341793
c = 119279592136391518960778700178474826421062018379899342254406783670889432182616590099071219538938202395671695005539485982613862823970622126945808954842683496637377151180225469409261800869161467402364879561554585345399947589618235872378329510108345004513054262809629917083343715270605155751457391599728436117833
h = 115812446451372389307840774747986196103012628652193338630796109042038320397499948364970459686079508388755154855414919871257982157430015224489195284512204803276307238226421244647463550637321174259849701618681565567468929295822889537962306471780258801529979716298619553323655541002084406217484482271693997457806
p0 = 4055618
q0 = None

head = n&gt;&gt;(1024-22)
for i in range(2**22):
    if (i*p0)&gt;&gt;22 == head:
        q0 = i
        break

PR.&lt;x&gt; = PolynomialRing(Zmod(n))
g = x+2021*2^490*p0+1120*2^490*q0
f = g^2-h*g+1

root = ZZ(f.small_roots(X=2^500, beta=1, epsilon=0.02)[0])
x0 = root+2021*2^490*p0+1120*2^490*q0
diff = isqrt(x0^2-4*2021*1120*n)
p = (x0+diff)//4042
q = (x0-diff)//2240
phi = (p-1)*(q-1)
d = inverse_mod(0x10001, phi)
m = pow(c, d, n)
print(bytes.fromhex(hex(m)[2:]))
</code></pre><h2 id="n1token1">n1token1</h2>
<p><strong>task.py</strong></p>
<pre tabindex="0"><code>from Crypto.Util.number import *
import random
from secret import flag
 
def gettoken(c):
    X = 0
    while ((pow(X, (p-1)//2, p)!=1) or (pow(X, (q-1)//2, q)!=1)):
        X = 1
        while X.bit_length() &lt; 920:
            X *= random.choice(primes)
    xp = pow(X, (p + 1)//4, p)
    xq = pow(X, (q + 1)//4, q)
    xp = random.choice([xp,-xp%p])
    xq = random.choice([xq,-xq%q])
    x = c * (xp*inverse(q,p)*q + xq*inverse(p,q)*p) % n
    return x
 
def getmyPrime(nbits):
    p = getPrime(nbits)
    while(p%4==1):
        p = getPrime(nbits)
    return p
 
primes = random.sample(sieve_base, 920)
p = getmyPrime(512)
q = getmyPrime(512)
e = 65537
n = p*q
c = pow(bytes_to_long(flag), e, n)
 
with open(&#34;output.txt&#34;, &#34;w&#34;)as f:
    f.write(&#34;n = &#34; + str(n) + &#34;\n&#34;)
    for i in range(920):
        f.write(&#34;Token #&#34;+str(i+1)+&#39;: &#39;+str(gettoken(c))+&#39;\n&#39;)
</code></pre><h2 id="solution-1">Solution</h2>
<p>The token generating as follow,</p>
<p>$tk_i = c\cdot \sqrt{X_i}(mod\ n)$</p>
<p>$\Rightarrow tk_i^2\cdot(c^{-2})=X_i(mod\ n)$ Where $X&lt;2^{940}$</p>
<p>So we can solve this hidden number problem to recover $X_i$.</p>
<p>$\Rightarrow tk_0^2\cdot (tk_i^2)^{-1}=X_0\cdot X_i^{-1}(mod\ n)$</p>
<p>Rewriting the $X_i$ with primes&rsquo; exponent, and solve the kernel of exponent matrix in $F_2$ (only care parity)</p>
<p>Finally, we can construct $a^2=b^2(mod\ n)$, it&rsquo;s probably get the factors of n.</p>
<pre tabindex="0"><code>from Crypto.Util.number import *
from functools import reduce

f = open(&#39;output.txt&#39;, &#39;r&#39;)
f.read(4)
n = int(f.readline())
tk = []
for _ in range(920):
    tk_ = f.readline()
    st = tk_.index(&#39;:&#39;)
    tk.append(int(tk_[st+1:]))

def solver_hnp(s):
    L = matrix(QQ, 101, 101)
    L[0, 0] = 2^(940-1024)
    for _ in range(100):
        L[0, _+1] = s[_]**2%n
        L[_+1, _+1] = n
    basis = L.LLL()[1]
    g = reduce(GCD, basis[1:])
    c_ = basis[0]*2^(1024-940)//g
    return c_

c_ = solver_hnp(tk[:100])
if (c_*tk[0]**2)%n &gt; 2^940:
    c_ = -c_

X = []
for tk_ in tk:
    X.append((tk_**2*(c_)%n))

primes = set()
for x in X:
    facs = list(factor(x))
    for item in facs:
        primes.add(item[0])
        
primes = list(primes)
ch = []
for x in X:
    u = [0]*920
    facs = list(factor(x))
    for item in facs:
        u[primes.index(item[0])] = item[1]
    ch.append(u)
    
std = vector(ZZ, ch[0])
Ch = []
for i in range(1, len(ch)):
    Ch.append(std-vector(ch[i]))
    
A = matrix(Zmod(2), Ch)
ker = vector(ZZ, list(A.left_kernel().matrix()[0]))
res = ker*matrix(ZZ, Ch)
a = 1; b = 1
for i in range(len(ker)):
    if ker[i]:
        a *= tk[0]
        b *= tk[i+1]

for i in range(len(res)):
    if res[i] &gt; 0:
        b *= pow(primes[i], res[i]//2, n)
    else:
        a *= pow(primes[i], abs(res[i])//2, n)

p = GCD(a+b, n)
q = n//p
Fp = GF(p)
Fq = GF(q)
phi = (p-1)*(q-1)
d = inverse_mod(0x10001, phi)
c2 = inverse_mod(X[0], n)*tk[0]**2%n
m2 = pow(c2, d, n)
mp = Fp(m2).nth_root(2, all=True)
mq = Fq(m2).nth_root(2, all=True)

for i in mp:
    for j in mq:
        m = crt([int(i), int(j)], [p, q])
        print(long_to_bytes(m))
</code></pre><h2 id="n1token2">n1token2</h2>
<p><strong>task.py</strong></p>
<pre tabindex="0"><code>import random
from secret import flag
 
assert FLAG.startswith(&#39;n1ctf{&#39;)
assert FLAG.endswith(&#39;}&#39;)
SECRET = bytes.fromhex(FLAG[6:-1])
assert len(SECRET) == 16
 
p = 251
 
e = [1, 20, 113, 149, 219]
 
y = b&#39;&#39; 
for x in range(1, p):
    coeff = [random.choice(e)] + list(SECRET)
    y += bytes([sum(c * pow(x, i, p) for i, c in enumerate(coeff)) % p])
    
print(f&#39;Token: {y.hex()}&#39;)
</code></pre><h2 id="solution-2">Solution</h2>
<p>We can use the prod idea to solve multiple choices problem</p>
<p>assume $F(x)=\sum_{i=1}\limits^{16}a_ix^i$</p>
<p>So the relation can be write as follow,</p>
<p>$\prod_{i=0}\limits^4(F(x_j)+e_i-y_j)=0$</p>
<p>$a_0+a_1\cdot F(x_j)+a_2\cdot F^2(x_j)+a_3\cdot F^3(x_j)+a_4\cdot F^4(x_j)+a_5\cdot F^5(x_j)=0$</p>
<p>Considering $F^j(x)$ as independent polynomial, there are total 245 unknow coefficients.</p>
<p>With 250 tokens, solving the matrix to recover all coefficient.</p>
<pre tabindex="0"><code>token = &#39;ae47d3533e10b444374ebd35f578103f94c327b5959f4580b0dc4701d089f22c282acfed2626bd9ced919547dacc96c18595468952cbedbcf518b5ec0fbc0437ea8e3bd77c5f01f73b555cc97a382df1ce28b4af7f9a5ab9c47e055044f47463c4f33bebdd4d6965599c71720b5a549a8246cb200dc4e2dccfc4765c0ac266a8a5385172aa47f834db737a3bcc725ae5a1ec8b76d1ca4800da10450b04543377efa5428584efdfdf55282e0e4410ae7848a0217a7d66f2d6c06c846a4755867dbdf61c70646f67debf44839a342e5f64e3abd2c9f5b66656edc8004cea987503793f7e07e3b60af4852e03177cae1e8ee605aab76d3a70df4e1e&#39;
p = 251
e = [1, 20, 113, 149, 219]
A = []
v = []
Z.&lt;x&gt; = PolynomialRing(Zmod(p))
for i in range(0, len(token), 2):
    tk = int(token[i:i+2], 16)
    a = []
    for e_ in e:
        a.append(e_-tk)
    f = (x+a[0])*(x+a[1])*(x+a[2])*(x+a[3])*(x+a[4])
    coeff = (list(f))[::-1]
    x0 = i//2+1
    u = []
    for _ in range(81):
        u.append(coeff[0]*x0^_)
    for _ in range(65):
        u.append(coeff[1]*x0^_)
    for _ in range(49):
        u.append(coeff[2]*x0^_)
    for _ in range(33):
        u.append(coeff[3]*x0^_)
    for _ in range(17):
        u.append(coeff[4]*x0^_)
    v.append(-coeff[-1])
    A.append(u)
    
A = matrix(Zmod(p), A)
v = vector(Zmod(p), v)
sol = A.solve_right(v)
secret = bytes(sol[-16:]).hex()
print(secret)
</code></pre>]]></content:encoded>
    </item>
    
    <item>
      <title>BalsnCTF2022   Vss</title>
      <link>https://r3t2b3d.github.io/posts/balsnctf2022-vss/</link>
      <pubDate>Fri, 27 Oct 2023 11:17:14 +0800</pubDate>
      
      <guid>https://r3t2b3d.github.io/posts/balsnctf2022-vss/</guid>
      <description>vss task.py
#!/opt/homebrew/bin/python3 from Crypto.Util.number import * from Crypto.Cipher import AES from Crypto.Util.Padding import pad import os import random from hashlib import sha256 FLAG = b&amp;#39;this_is_a_test_flag&amp;#39; class ShareScheme: def __init__(self, key: bytes): assert len(key) == 128 self.key1 = bytes_to_long(key[:64]) self.key2 = bytes_to_long(key[64:]) def getShare(self): p = getPrime(512) a = random.randint(2, p - 1) b = random.randint(2, p - 1) c = random.randint(2, p - 1) y = (a &#43; self.key1 * b &#43; self.</description>
      <content:encoded><![CDATA[<h2 id="vss">vss</h2>
<p><code>task.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/opt/homebrew/bin/python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.Padding <span style="color:#f92672">import</span> pad
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> hashlib <span style="color:#f92672">import</span> sha256
</span></span><span style="display:flex;"><span>FLAG <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;this_is_a_test_flag&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ShareScheme</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, key: bytes):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> len(key) <span style="color:#f92672">==</span> <span style="color:#ae81ff">128</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>key1 <span style="color:#f92672">=</span> bytes_to_long(key[:<span style="color:#ae81ff">64</span>])
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>key2 <span style="color:#f92672">=</span> bytes_to_long(key[<span style="color:#ae81ff">64</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getShare</span>(self):
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> getPrime(<span style="color:#ae81ff">512</span>)
</span></span><span style="display:flex;"><span>        a <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">2</span>, p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        b <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">2</span>, p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        c <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">2</span>, p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        y <span style="color:#f92672">=</span> (a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>key1 <span style="color:#f92672">*</span> b <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>key2 <span style="color:#f92672">*</span> c) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> p, a, b, c, y
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">commit</span>(val: int):
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> getPrime(<span style="color:#ae81ff">512</span>)
</span></span><span style="display:flex;"><span>    g <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">2</span>, p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Commitment: </span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">{</span>g<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">{</span>pow(g, val, p)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">128</span>)
</span></span><span style="display:flex;"><span>ss <span style="color:#f92672">=</span> ShareScheme(key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>real_key <span style="color:#f92672">=</span> sha256(key)<span style="color:#f92672">.</span>digest()[:<span style="color:#ae81ff">16</span>]
</span></span><span style="display:flex;"><span>cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(real_key, AES<span style="color:#f92672">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>enc_flag <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>encrypt(pad(FLAG, <span style="color:#ae81ff">16</span>))
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;flag = </span><span style="color:#e6db74">{</span>enc_flag<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    op <span style="color:#f92672">=</span> int(input(<span style="color:#e6db74">&#34;Option: &#34;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> op <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        p, a, b, c, y <span style="color:#f92672">=</span> ss<span style="color:#f92672">.</span>getShare()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>p <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>a <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>b <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>c <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        commit(y)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><h2 id="soulution">Soulution</h2>
<p>We can get $a,b,c$ from share, $y=a+b\cdot x_1+c\cdot x_2$</p>
<p>Commitment $(p,\ g,\ com)$ is known which satisfy  $com=g^y\ (mod\ p)$.</p>
<p>if $p-1$ has small factors $n$, using pohlig-hellman can recover $s=y\ (mod\ n)$</p>
<p>Rewriting the equation,
$$
s+k\cdot n=a+b\cdot x_1+c\cdot x_2\ (mod\ p)
$$
Choose the data, which $n&gt;2^{t}$ .</p>
<p>Bit length of $x_1,\ x_2$ is 512, $s&lt;n,\ k&lt;\frac{p}{n}$</p>
<p>So combine the relation through sufficient share equation using CRT.</p>
<p>It looks like this,
$$
S+\sum n_i&rsquo;\cdot k_i=A+B\cdot x_1+C\cdot x_2\ (\ mod\ \prod p_i)
$$
$k_i,x_1,x_2$ is unknown, we can apply LLL to solve this, the lattice is as follow
$$
\left[\begin{matrix}
1&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;B\\
&amp;1&amp;&amp;&amp;&amp;&amp;&amp;&amp;C\\
&amp;&amp;2^{512}&amp;&amp;&amp;&amp;&amp;&amp;(A-S)\\
&amp;&amp;&amp;2^{t}&amp;&amp;&amp;&amp;&amp;n_1&rsquo;\\
&amp;&amp;&amp;&amp;&amp;\cdots&amp;\\
&amp;&amp;&amp;&amp;&amp;&amp;&amp;2^{t}&amp;n_l&rsquo;\\
&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;\prod p_i
\end{matrix}\right]
$$</p>
<p>The vector $(x_1,\ x_2,\ 2^{512},\ 2^t\cdot k_1,\ \cdots,\ 2^t\cdot k_l,\ 0)$ is in the lattice,</p>
<p>We hope to make the vector is shorter than minkowsiki bound,</p>
<p>$\Rightarrow 2^{512\cdot l+t\cdot l+512}&gt;2^{512\cdot(l+4)}$</p>
<p>$\Rightarrow t&gt;\frac{512\cdot3}{l}$</p>
<p>I use the parameter $t=30,\ l=55$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> hashlib <span style="color:#f92672">import</span> sha256
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</span></span><span style="display:flex;"><span><span style="color:#75715e">#context(log_level=&#34;debug&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># def matrix_overview(BB):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     for ii in range(BB.dimensions()[0]):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         a = (&#39;%02d &#39;%ii)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         for jj in range(BB.dimensions()[1]):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             if BB[ii,jj] == 0:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#                 a += &#39; &#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             else:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#                 a += &#39;X&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             if BB.dimensions()[0] &lt; 60:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#                 a += &#39; &#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         print(a)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DB <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> p <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">23</span>:
</span></span><span style="display:flex;"><span>    DB<span style="color:#f92672">.</span>append(p)
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> next_prime(p)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">bsgs</span>(g, y, bound, p):
</span></span><span style="display:flex;"><span>    step <span style="color:#f92672">=</span> isqrt(bound)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    dir <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(step):
</span></span><span style="display:flex;"><span>        dir[str(y<span style="color:#f92672">*</span>inverse_mod(pow(g, i, p), p)<span style="color:#f92672">%</span>p)] <span style="color:#f92672">=</span> i
</span></span><span style="display:flex;"><span>    g_ <span style="color:#f92672">=</span> pow(g, step, p)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(step):
</span></span><span style="display:flex;"><span>        idx <span style="color:#f92672">=</span> pow(g_, i, p)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> str(idx) <span style="color:#f92672">in</span> dir<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> i<span style="color:#f92672">*</span>step <span style="color:#f92672">+</span> dir[str(idx)]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_ord</span>(g, p, t):
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> n<span style="color:#f92672">%</span>t <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> n<span style="color:#f92672">//</span>t
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> pow(g, n, p) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">PH</span>(p, g, y):
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    dl <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    ml <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> DB:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> n<span style="color:#f92672">%</span>item <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            g_ <span style="color:#f92672">=</span> pow(g, n<span style="color:#f92672">//</span>item, p)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> g_ <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>            y_ <span style="color:#f92672">=</span> pow(y, n<span style="color:#f92672">//</span>item, p)
</span></span><span style="display:flex;"><span>            d <span style="color:#f92672">=</span> bsgs(g_, y_, item, p)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">assert</span> pow(g_, d, p) <span style="color:#f92672">==</span> y_
</span></span><span style="display:flex;"><span>            dl<span style="color:#f92672">.</span>append(d)
</span></span><span style="display:flex;"><span>            ml<span style="color:#f92672">.</span>append(item)
</span></span><span style="display:flex;"><span>    F <span style="color:#f92672">=</span> GF(p)
</span></span><span style="display:flex;"><span>    g1 <span style="color:#f92672">=</span> F(pow(g, n<span style="color:#f92672">//</span>prod(ml), p))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> ml:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> test_ord(g, p, item):
</span></span><span style="display:flex;"><span>            dl<span style="color:#f92672">.</span>remove(dl[ml<span style="color:#f92672">.</span>index(item)])
</span></span><span style="display:flex;"><span>            ml<span style="color:#f92672">.</span>remove(item)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> prod(ml) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">30</span>: <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (crt(dl, ml), prod(ml))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solver</span>(al, bl, cl, yl, nl, kl):
</span></span><span style="display:flex;"><span>    bound <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>    t <span style="color:#f92672">=</span> <span style="color:#ae81ff">55</span>
</span></span><span style="display:flex;"><span>    B <span style="color:#f92672">=</span> crt(bl, nl)
</span></span><span style="display:flex;"><span>    C <span style="color:#f92672">=</span> crt(cl, nl)
</span></span><span style="display:flex;"><span>    A <span style="color:#f92672">=</span> crt([al[i]<span style="color:#f92672">-</span>yl[i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(al))], nl)
</span></span><span style="display:flex;"><span>    D <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(t):
</span></span><span style="display:flex;"><span>        D<span style="color:#f92672">.</span>append(crt([<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span>i<span style="color:#f92672">+</span>[kl[i]]<span style="color:#f92672">+</span>[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span>(t<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>i), nl))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    L <span style="color:#f92672">=</span> matrix(ZZ, t<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>, t<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    L[<span style="color:#ae81ff">0</span>, t<span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> B
</span></span><span style="display:flex;"><span>    L[<span style="color:#ae81ff">1</span>, t<span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> C
</span></span><span style="display:flex;"><span>    L[<span style="color:#ae81ff">2</span>, t<span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> A
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>        L[_, _] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    L[<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">^</span><span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">3</span>, t<span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>        L[_, _] <span style="color:#f92672">=</span> bound
</span></span><span style="display:flex;"><span>        L[_, t<span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> D[_<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    L[t<span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>, t<span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> prod(nl)
</span></span><span style="display:flex;"><span>    mb <span style="color:#f92672">=</span> int(L<span style="color:#f92672">.</span>det()<span style="color:#f92672">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>(t<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>)))
</span></span><span style="display:flex;"><span>    print(mb<span style="color:#f92672">.</span>bit_length())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> mb<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span>    basis <span style="color:#f92672">=</span> L<span style="color:#f92672">.</span>LLL()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> basis[<span style="color:#ae81ff">0</span>], basis[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io <span style="color:#f92672">=</span> process(<span style="color:#e6db74">&#34;./chall.py&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>para <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;flag = &#34;</span>)
</span></span><span style="display:flex;"><span>flag_enc <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(io<span style="color:#f92672">.</span>recvline()[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>decode())
</span></span><span style="display:flex;"><span>al, bl, cl, yl, nl, kl <span style="color:#f92672">=</span> [[] <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">6</span>)]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> len(al) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">55</span>:
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendlineafter(<span style="color:#e6db74">&#34;Option: &#34;</span>, <span style="color:#e6db74">&#39;1&#39;</span>)
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;p = &#34;</span>)
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> int(io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;a = &#34;</span>)
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> int(io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;b = &#34;</span>)
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">=</span> int(io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;c = &#34;</span>)
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> int(io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;Commitment: &#34;</span>)
</span></span><span style="display:flex;"><span>    com <span style="color:#f92672">=</span> list(map(int, io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>decode()<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; &#39;</span>)))
</span></span><span style="display:flex;"><span>    k <span style="color:#f92672">=</span> PH(<span style="color:#f92672">*</span>com)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> k:
</span></span><span style="display:flex;"><span>        al<span style="color:#f92672">.</span>append(a)
</span></span><span style="display:flex;"><span>        bl<span style="color:#f92672">.</span>append(b)
</span></span><span style="display:flex;"><span>        cl<span style="color:#f92672">.</span>append(c)
</span></span><span style="display:flex;"><span>        yl<span style="color:#f92672">.</span>append(k[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>        nl<span style="color:#f92672">.</span>append(p)
</span></span><span style="display:flex;"><span>        kl<span style="color:#f92672">.</span>append(k[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Start solver&#34;</span>)
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> solver(al, bl, cl, yl, nl, kl)
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> long_to_bytes(abs(key[<span style="color:#ae81ff">0</span>]))<span style="color:#f92672">+</span>long_to_bytes(abs(key[<span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>real_key <span style="color:#f92672">=</span> sha256(key)<span style="color:#f92672">.</span>digest()[:<span style="color:#ae81ff">16</span>]
</span></span><span style="display:flex;"><span>cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(real_key, AES<span style="color:#f92672">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>decrypt(flag_enc)
</span></span><span style="display:flex;"><span>print(flag)
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>CorCTF2022   corrupted curves&#43;</title>
      <link>https://r3t2b3d.github.io/posts/corctf2022-corrupted-curves&#43;/</link>
      <pubDate>Thu, 26 Oct 2023 00:44:01 +0800</pubDate>
      
      <guid>https://r3t2b3d.github.io/posts/corctf2022-corrupted-curves&#43;/</guid>
      <description>corrupted curves&#43; task.py
#!/opt/homebrew/bin/python3 from secrets import randbits from Crypto.Util.number import getPrime from random import randrange def square_root(a, p): if legendre_symbol(a, p) != 1: return 0 elif a == 0: return 0 elif p == 2: return 0 elif p % 4 == 3: return pow(a, (p &#43; 1) // 4, p) s = p - 1 e = 0 while s % 2 == 0: s //= 2 e &#43;= 1 n = 2 while legendre_symbol(n, p) !</description>
      <content:encoded><![CDATA[<h2 id="corrupted-curves">corrupted curves+</h2>
<p><code>task.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/opt/homebrew/bin/python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> secrets <span style="color:#f92672">import</span> randbits
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> getPrime
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> random <span style="color:#f92672">import</span> randrange
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">square_root</span>(a, p):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> legendre_symbol(a, p) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> a <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> p <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> p <span style="color:#f92672">%</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> pow(a, (p <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">4</span>, p)
</span></span><span style="display:flex;"><span>    s <span style="color:#f92672">=</span> p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> s <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        s <span style="color:#f92672">//=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        e <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> legendre_symbol(n, p) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> pow(a, (s <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>, p)
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">=</span> pow(a, s, p)
</span></span><span style="display:flex;"><span>    g <span style="color:#f92672">=</span> pow(n, s, p)
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> e
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> b
</span></span><span style="display:flex;"><span>        m <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> m <span style="color:#f92672">in</span> range(r):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> t <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            t <span style="color:#f92672">=</span> pow(t, <span style="color:#ae81ff">2</span>, p)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> m <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> x
</span></span><span style="display:flex;"><span>        gs <span style="color:#f92672">=</span> pow(g, <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> (r <span style="color:#f92672">-</span> m <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>), p)
</span></span><span style="display:flex;"><span>        g <span style="color:#f92672">=</span> (gs <span style="color:#f92672">*</span> gs) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> (x <span style="color:#f92672">*</span> gs) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        b <span style="color:#f92672">=</span> (b <span style="color:#f92672">*</span> g) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">legendre_symbol</span>(a, p):
</span></span><span style="display:flex;"><span>    ls <span style="color:#f92672">=</span> pow(a, (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>, p)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> ls <span style="color:#f92672">==</span> p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">else</span> ls
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EllipticCurve</span>:
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, p, a, b):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>b <span style="color:#f92672">=</span> b
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>p <span style="color:#f92672">=</span> p
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>check_curve():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;Not an elliptic curve!&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_curve</span>(self):
</span></span><span style="display:flex;"><span>        discrim <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">16</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>pow(self<span style="color:#f92672">.</span>a, <span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">27</span><span style="color:#f92672">*</span>pow(self<span style="color:#f92672">.</span>b, <span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> discrim <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>p:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lift_x</span>(self, px):
</span></span><span style="display:flex;"><span>        y2 <span style="color:#f92672">=</span> (pow(px, <span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>a<span style="color:#f92672">*</span>px <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>b) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>p
</span></span><span style="display:flex;"><span>        py <span style="color:#f92672">=</span> square_root(y2, self<span style="color:#f92672">.</span>p)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> py <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;No point on elliptic curve.&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> py
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;this_is_a_sample_flag&#39;</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> int<span style="color:#f92672">.</span>from_bytes(flag, <span style="color:#e6db74">&#39;big&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Generating parameters...&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> getPrime(<span style="color:#ae81ff">512</span>)
</span></span><span style="display:flex;"><span>    a, b <span style="color:#f92672">=</span> randbits(<span style="color:#ae81ff">384</span>), randbits(<span style="color:#ae81ff">384</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        E <span style="color:#f92672">=</span> EllipticCurve(p, a, b)
</span></span><span style="display:flex;"><span>        fy <span style="color:#f92672">=</span> E<span style="color:#f92672">.</span>lift_x(flag)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;p = </span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;flag y = </span><span style="color:#e6db74">{</span>fy<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>checked <span style="color:#f92672">=</span> set()
</span></span><span style="display:flex;"><span>count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> count <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2022</span>:
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> randrange(<span style="color:#ae81ff">2</span>, p)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> int(x) <span style="color:#f92672">in</span> checked <span style="color:#f92672">or</span> x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">384</span> <span style="color:#f92672">or</span> abs(x <span style="color:#f92672">-</span> p) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">384</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;&gt;:(&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        e <span style="color:#f92672">=</span> randbits(<span style="color:#ae81ff">48</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;e = </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        E <span style="color:#f92672">=</span> EllipticCurve(p, a<span style="color:#f92672">^</span>e, b<span style="color:#f92672">^</span>e)
</span></span><span style="display:flex;"><span>        py <span style="color:#f92672">=</span> E<span style="color:#f92672">.</span>lift_x(x)
</span></span><span style="display:flex;"><span>        checked<span style="color:#f92672">.</span>add(x)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;x = </span><span style="color:#e6db74">{</span>x<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;y = </span><span style="color:#e6db74">{</span>py<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;:(&#34;</span>)
</span></span><span style="display:flex;"><span>    more <span style="color:#f92672">=</span> input(<span style="color:#e6db74">&#34;more&gt; &#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> more<span style="color:#f92672">.</span>strip() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;no&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;bye!&#34;</span>)
</span></span></code></pre></div><h2 id="solution">Solution</h2>
<p>I find the challenge <code>e2D1p</code> which I made in n1ctf has the same idea with this.</p>
<p>First, we can get $y_0,p$ which satisfy the equation $y_0^2=m^3+a*m+b\ (mod\ p)$</p>
<p>Then we should recover $a,b$  with 2022 inquire oppotunities.</p>
<p>In every inquiry, we have $y^2=x^3+(a\oplus e)*x+(b\oplus e)\ (mod\ q)$ with $x,y,e$ known.</p>
<p>Rewriting the equation as follow,
$$
y^2=x^3+a_l*x+\sum\limits_{i=0}\limits^{47}2^i\cdot(a_i\oplus e_i)*x+b_l+\sum\limits_{i=0}\limits^{47}2^i\cdot(b_i\oplus e_i)\ (mod\ p)
$$
By the way,  for one bit message $a,b$
$$
a\oplus b =
\begin{cases}
a&amp; \text{b=0}\\
1-a&amp; \text{b=1}
\end{cases}
$$
The equation can be converted the linear expression about $a_l,\ b_l,\ a_i,\ b_i$</p>
<p>We can solve these variables by collect 98 equations.</p>
<p>So, if we get $a\ b$, just need to find the root of $x^3+a*x+b-y_0^2\ (mod\ p)$. That&rsquo;s easy!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>io <span style="color:#f92672">=</span> process(<span style="color:#e6db74">&#34;./corruptedcurvesplus.py&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;p = &#34;</span>)
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> int(io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;flag y = &#34;</span>)
</span></span><span style="display:flex;"><span>flag_y <span style="color:#f92672">=</span> int(io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bound <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>maxb <span style="color:#f92672">=</span> <span style="color:#ae81ff">98</span>
</span></span><span style="display:flex;"><span>para <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> bound <span style="color:#f92672">&lt;</span> maxb:
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;e = &#34;</span>)
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> int(io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>    sign <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recvline()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;:(&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> sign:
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> int(sign[<span style="color:#ae81ff">4</span>:])
</span></span><span style="display:flex;"><span>        io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;y = &#34;</span>)
</span></span><span style="display:flex;"><span>        y <span style="color:#f92672">=</span> int(io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>        bound <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        para<span style="color:#f92672">.</span>append((e, x, y))
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendlineafter(<span style="color:#e6db74">&#34;more&gt; &#34;</span>, <span style="color:#e6db74">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mat <span style="color:#f92672">=</span> matrix(Zmod(p), maxb, <span style="color:#ae81ff">98</span>)
</span></span><span style="display:flex;"><span>u <span style="color:#f92672">=</span> vector(Zmod(p), maxb)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(maxb):
</span></span><span style="display:flex;"><span>    e, x, y <span style="color:#f92672">=</span> para[i]
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> y<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span>x<span style="color:#f92672">**</span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    mat[i, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> x; mat[i, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">48</span>):
</span></span><span style="display:flex;"><span>        ej <span style="color:#f92672">=</span> (e<span style="color:#f92672">&gt;&gt;</span>j)<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ej:
</span></span><span style="display:flex;"><span>            r <span style="color:#f92672">-=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>j<span style="color:#f92672">*</span>(x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            mat[i, j<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>x<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>j<span style="color:#f92672">%</span>p
</span></span><span style="display:flex;"><span>            mat[i, j<span style="color:#f92672">+</span><span style="color:#ae81ff">50</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>j<span style="color:#f92672">%</span>p
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            mat[i, j<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> x<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>j<span style="color:#f92672">%</span>p
</span></span><span style="display:flex;"><span>            mat[i, j<span style="color:#f92672">+</span><span style="color:#ae81ff">50</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>j<span style="color:#f92672">%</span>p
</span></span><span style="display:flex;"><span>    u[i] <span style="color:#f92672">=</span> r<span style="color:#f92672">%</span>p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> mat<span style="color:#f92672">.</span>det() <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>sol <span style="color:#f92672">=</span> mat<span style="color:#f92672">.</span>solve_right(u)
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> sum([sol[<span style="color:#ae81ff">0</span>]]<span style="color:#f92672">+</span>[sol[i<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">48</span>)])
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> sum([sol[<span style="color:#ae81ff">1</span>]]<span style="color:#f92672">+</span>[sol[i<span style="color:#f92672">+</span><span style="color:#ae81ff">50</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">48</span>)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PR<span style="color:#f92672">.&lt;</span>x<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> PolynomialRing(GF(p))
</span></span><span style="display:flex;"><span>F <span style="color:#f92672">=</span> x<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span><span style="color:#f92672">+</span>a<span style="color:#f92672">*</span>x<span style="color:#f92672">+</span>b<span style="color:#f92672">-</span>flag_y<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>root <span style="color:#f92672">=</span> F<span style="color:#f92672">.</span>roots()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> root:
</span></span><span style="display:flex;"><span>    print(bytes<span style="color:#f92672">.</span>fromhex(hex(item[<span style="color:#ae81ff">0</span>])[<span style="color:#ae81ff">2</span>:]))
</span></span></code></pre></div><p>After that I find another way to solve the prolem using LLL, just 2 query needed. <a href="https://jsur.in/posts/2022-08-08-corctf-2022-crypto-writeups#corrupted-curves">joseph&rsquo;s wu</a></p>
]]></content:encoded>
    </item>
    
  </channel>
</rss>